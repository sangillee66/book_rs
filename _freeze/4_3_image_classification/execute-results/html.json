{
  "hash": "34ecce0b3d63747630af3f4e07edc384",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"영상 분류\"\nauthor: Sang-Il Lee\ndate-modified: last-modified\nnumber-sections: true\nformat: \n  html: \n    toc: true\ncode-link: true\ncode-copy: true\nlightbox: true\nexecute: \n  warning: false\n  error: false\n  freeze: auto\neditor: visual\neditor_options: \n  chunk_output_type: console\n---\n\n\n## 개요\n\n필수적인 패키지를 불러온다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(terra)\nlibrary(tmap)\nlibrary(RStoolbox)\n# library(randomForest)\n# library(kernlab)\n# library(RSNNS)\n# library(C50)\n```\n:::\n\n\n예제 데이터를 불러온다.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain <- readRDS(system.file(\"external/trainingPolygons_lsat.rds\", package=\"RStoolbox\"))\nlsat_str <- lsat |> \n  stretch(minv = 0, maxv = 255, minq = 0.05, maxq = 0.95)\n\nmy_map <- tm_shape(lsat_str) + tm_rgb(r = 3, g =2, b =1) +\n  tm_layout(legend.outside = TRUE)\nmy_map\n```\n\n::: {.cell-output-display}\n![](4_3_image_classification_files/figure-html/unnamed-chunk-3-1.png){width=7200}\n:::\n:::\n\n\n## 감독 분류\n\n훈련 데이터를 불러온다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_map <- tm_shape(lsat_str) + \n  tm_rgb(r = 3, g =2, b =1) +\n  tm_shape(train) + \n  tm_polygons(col = \"class\", \n              palette = c(\"yellow\", \"sandybrown\", \"darkgreen\", \"blue\")) +\n  tm_layout(legend.outside = TRUE)\nmy_map\n```\n\n::: {.cell-output-display}\n![](4_3_image_classification_files/figure-html/unnamed-chunk-4-1.png){width=7200}\n:::\n:::\n\n\n최대 우도(maximum likelihood) 분류 알고리즘을 적용하여 감독 분류를 실행한다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsc_mlc <- superClass(\n  lsat, \n  trainData = train, \n  responseCol = \"class\",\n  model = \"mlc\", \n  tuneLength = 1, trainPartition = 0.7\n  )\n\nsc_mlc$modelFit\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n  TrainAccuracy TrainKappa method\n1     0.9956484   0.992674 custom\n\n[[2]]\nCross-Validated (5 fold) Confusion Matrix \n\n(entries are average cell counts across resamples)\n \n            Reference\nPrediction   cleared fallen_dry forest water\n  cleared       97.4        0.0    1.4   0.0\n  fallen_dry     0.0       14.6    0.2   0.2\n  forest         0.2        0.0  261.4   0.0\n  water          0.0        0.0    0.0  84.2\n                            \n Accuracy (average) : 0.9956\n```\n\n\n:::\n\n```{.r .cell-code}\nsc_mlc$validation$performance\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nConfusion Matrix and Statistics\n\n            Reference\nPrediction   cleared fallen_dry forest water\n  cleared        446          0      3     0\n  fallen_dry       0         51      0     0\n  forest           0          0    513     0\n  water            0          0      0   178\n\nOverall Statistics\n                                          \n               Accuracy : 0.9975          \n                 95% CI : (0.9927, 0.9995)\n    No Information Rate : 0.4332          \n    P-Value [Acc > NIR] : < 2.2e-16       \n                                          \n                  Kappa : 0.9961          \n                                          \n Mcnemar's Test P-Value : NA              \n\nStatistics by Class:\n\n                     Class: cleared Class: fallen_dry Class: forest\nSensitivity                  1.0000           1.00000        0.9942\nSpecificity                  0.9960           1.00000        1.0000\nPos Pred Value               0.9933           1.00000        1.0000\nNeg Pred Value               1.0000           1.00000        0.9956\nPrevalence                   0.3745           0.04282        0.4332\nDetection Rate               0.3745           0.04282        0.4307\nDetection Prevalence         0.3770           0.04282        0.4307\nBalanced Accuracy            0.9980           1.00000        0.9971\n                     Class: water\nSensitivity                1.0000\nSpecificity                1.0000\nPos Pred Value             1.0000\nNeg Pred Value             1.0000\nPrevalence                 0.1495\nDetection Rate             0.1495\nDetection Prevalence       0.1495\nBalanced Accuracy          1.0000\n```\n\n\n:::\n:::\n\n\n결과를 지도를 제작한다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nr <- as.factor(sc_mlc$map)\nlevels(r) <- data.frame(ID = 1:4, class_supervised = levels(train$class))\n\ntm_shape(r) + tm_raster(\n  palette = c(\"yellow\", \"sandybrown\", \"darkgreen\", \"blue\"), \n  title = \"Supervised: \\n Maximum Likelihood\") +\n  tm_layout(legend.outside = TRUE) \n```\n\n::: {.cell-output-display}\n![](4_3_image_classification_files/figure-html/unnamed-chunk-6-1.png){width=7200}\n:::\n:::\n\n\n## 무감독 분류\n\n*k*-평균 분류법을 적용한다. 우선 클래스의 개수를 3개로 한 무감독 분류를 실행한다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nuc <- unsuperClass(lsat, nClasses = 3)\nuc_r <- as.factor(uc$map)\ntm_shape(uc_r) + \n  tm_raster(palette = \"Set1\", title = \"Classes\") +\n  tm_layout(legend.outside = TRUE, \n            title = \"K-Means Clustering: \\n3 Classes\")\n```\n\n::: {.cell-output-display}\n![](4_3_image_classification_files/figure-html/unnamed-chunk-7-1.png){width=7200}\n:::\n:::\n\n\n클래스 개수를 4개로 한다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nuc <- unsuperClass(lsat, nClasses = 4)\nuc_r <- as.factor(uc$map)\ntm_shape(uc_r) + tm_raster(palette = \"Set1\", title = \"Classes\") +\n  tm_layout(legend.outside = TRUE, title = \"K-Means Clustering: \\n4 Classes\")\n```\n\n::: {.cell-output-display}\n![](4_3_image_classification_files/figure-html/unnamed-chunk-8-1.png){width=7200}\n:::\n:::\n\n\n클래스 개수를 5개로 한다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nuc <- unsuperClass(lsat, nClasses = 5)\nuc_r <- as.factor(uc$map)\ntm_shape(uc_r) + tm_raster(palette = \"Set1\", title = \"Classes\") +\n  tm_layout(\n    legend.outside = TRUE, \n    title = \"K-Means Clustering: \\n5 Classes\")\n```\n\n::: {.cell-output-display}\n![](4_3_image_classification_files/figure-html/unnamed-chunk-9-1.png){width=7200}\n:::\n:::\n\n\n## 혼합 분류\n\n## 분광혼합분석\n\n[`RStoolbox`](https://bleutner.github.io/RStoolbox/) 패키지의 `mesma()` 함수를 활용하면 spectral unmixing이 가능하다.\n\n## 객체-기반 분류\n\n## 인공지능-기반 분류\n\n인공지능-기반 분류법은 모두 감독 분류이기 때문에 위의 최대 우도법과 마찬가지로 훈련 데이터가 필요하다.\n\n### 결정 트리(decision tree)\n\n결정 트리 알고리즘을 적용한다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsc_dt <- superClass(\n  lsat, \n  trainData = train, \n  responseCol = \"class\",\n  model = \"C5.0\", \n  tuneLength = 1, \n  trainPartition = 0.7)\n\nsc_dt$modelFit\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n  TrainAccuracy TrainKappa method\n1     0.9971528  0.9954528   C5.0\n\n[[2]]\nCross-Validated (5 fold) Confusion Matrix \n\n(entries are average cell counts across resamples)\n \n            Reference\nPrediction   cleared fallen_dry forest water\n  cleared      126.2        0.0    0.4   0.0\n  fallen_dry     0.4       16.6    0.0   0.2\n  forest         0.4        0.0  255.8   0.0\n  water          0.0        0.0    0.0  91.4\n                            \n Accuracy (average) : 0.9972\n```\n\n\n:::\n\n```{.r .cell-code}\nsc_dt$validation$performance\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nConfusion Matrix and Statistics\n\n            Reference\nPrediction   cleared fallen_dry forest water\n  cleared        295          0      3     0\n  fallen_dry       2         41      0     0\n  forest           2          0    375     0\n  water            0          0      0   142\n\nOverall Statistics\n                                          \n               Accuracy : 0.9919          \n                 95% CI : (0.9833, 0.9967)\n    No Information Rate : 0.4395          \n    P-Value [Acc > NIR] : < 2.2e-16       \n                                          \n                  Kappa : 0.9876          \n                                          \n Mcnemar's Test P-Value : NA              \n\nStatistics by Class:\n\n                     Class: cleared Class: fallen_dry Class: forest\nSensitivity                  0.9866           1.00000        0.9921\nSpecificity                  0.9947           0.99756        0.9959\nPos Pred Value               0.9899           0.95349        0.9947\nNeg Pred Value               0.9929           1.00000        0.9938\nPrevalence                   0.3477           0.04767        0.4395\nDetection Rate               0.3430           0.04767        0.4360\nDetection Prevalence         0.3465           0.05000        0.4384\nBalanced Accuracy            0.9906           0.99878        0.9940\n                     Class: water\nSensitivity                1.0000\nSpecificity                1.0000\nPos Pred Value             1.0000\nNeg Pred Value             1.0000\nPrevalence                 0.1651\nDetection Rate             0.1651\nDetection Prevalence       0.1651\nBalanced Accuracy          1.0000\n```\n\n\n:::\n:::\n\n\n분류 결과를 지도로 나타낸다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nr <- as.factor(sc_dt$map)\nlevels(r) <- data.frame(ID = 1:4, class_supervised = levels(train$class))\n\ntm_shape(r) + tm_raster(\n  palette = c(\"yellow\", \"sandybrown\", \"darkgreen\", \"blue\"),\n  title = \"Classes\") +\n  tm_layout(\n    legend.outside = TRUE, \n    title = \"AI-based Classification: \\nDecision Tree\")\n```\n\n::: {.cell-output-display}\n![](4_3_image_classification_files/figure-html/unnamed-chunk-11-1.png){width=7200}\n:::\n:::\n\n\n### 랜덤 포레스트(random forest)\n\n랜덤 포레스트 알고리즘을 적용한다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsc_rf <- superClass(\n  lsat, \n  trainData = train, \n  responseCol = \"class\",\n  model = \"rf\", \n  tuneLength = 1, \n  trainPartition = 0.7)\n\nsc_rf$modelFit\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n  TrainAccuracy TrainKappa method\n1     0.9979279  0.9966294     rf\n\n[[2]]\nCross-Validated (5 fold) Confusion Matrix \n\n(entries are average cell counts across resamples)\n \n            Reference\nPrediction   cleared fallen_dry forest water\n  cleared      117.0        0.0    0.0   0.0\n  fallen_dry     0.2       19.2    0.0   0.0\n  forest         0.8        0.0  261.2   0.0\n  water          0.0        0.0    0.0  84.4\n                            \n Accuracy (average) : 0.9979\n```\n\n\n:::\n\n```{.r .cell-code}\nsc_rf$validation$performance\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nConfusion Matrix and Statistics\n\n            Reference\nPrediction   cleared fallen_dry forest water\n  cleared        342          0      0     0\n  fallen_dry       0         28      0     0\n  forest           2          0    434     0\n  water            0          0      0   178\n\nOverall Statistics\n                                          \n               Accuracy : 0.998           \n                 95% CI : (0.9927, 0.9998)\n    No Information Rate : 0.4411          \n    P-Value [Acc > NIR] : < 2.2e-16       \n                                          \n                  Kappa : 0.9969          \n                                          \n Mcnemar's Test P-Value : NA              \n\nStatistics by Class:\n\n                     Class: cleared Class: fallen_dry Class: forest\nSensitivity                  0.9942           1.00000        1.0000\nSpecificity                  1.0000           1.00000        0.9964\nPos Pred Value               1.0000           1.00000        0.9954\nNeg Pred Value               0.9969           1.00000        1.0000\nPrevalence                   0.3496           0.02846        0.4411\nDetection Rate               0.3476           0.02846        0.4411\nDetection Prevalence         0.3476           0.02846        0.4431\nBalanced Accuracy            0.9971           1.00000        0.9982\n                     Class: water\nSensitivity                1.0000\nSpecificity                1.0000\nPos Pred Value             1.0000\nNeg Pred Value             1.0000\nPrevalence                 0.1809\nDetection Rate             0.1809\nDetection Prevalence       0.1809\nBalanced Accuracy          1.0000\n```\n\n\n:::\n:::\n\n\n분류 결과를 지도로 나타낸다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nr <- as.factor(sc_rf$map)\nlevels(r) <- data.frame(ID = 1:4, class_supervised = levels(train$class))\n\ntm_shape(r) + tm_raster(\n  palette = c(\"yellow\", \"sandybrown\", \"darkgreen\", \"blue\"),\n  title = \"Classes\") +\n  tm_layout(\n    legend.outside = TRUE, \n    title = \"AI-based Classification: \\n Random Forest\")\n```\n\n::: {.cell-output-display}\n![](4_3_image_classification_files/figure-html/unnamed-chunk-13-1.png){width=7200}\n:::\n:::\n\n\n### 스포트 벡터 머신(support vector machine)\n\n스포트 벡터 머신 알고리즘을 적용한다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsc_svm <- superClass(\n  lsat, \n  trainData = train, \n  responseCol = \"class\",\n  model = \"svmRadial\", \n  tuneLength = 1, \n  trainPartition = 0.7)\n\nsc_svm$modelFit\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n  TrainAccuracy TrainKappa    method\n1     0.9991416   0.998611 svmRadial\n\n[[2]]\nCross-Validated (5 fold) Confusion Matrix \n\n(entries are average cell counts across resamples)\n \n            Reference\nPrediction   cleared fallen_dry forest water\n  cleared      107.8        0.0    0.2   0.0\n  fallen_dry     0.0       14.6    0.0   0.0\n  forest         0.2        0.0  249.6   0.0\n  water          0.0        0.0    0.0  94.0\n                            \n Accuracy (average) : 0.9991\n```\n\n\n:::\n\n```{.r .cell-code}\nsc_svm$validation$performance\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nConfusion Matrix and Statistics\n\n            Reference\nPrediction   cleared fallen_dry forest water\n  cleared        392          2      0     0\n  fallen_dry       0         49      0     0\n  forest           2          0    437     0\n  water            0          0      0   130\n\nOverall Statistics\n                                          \n               Accuracy : 0.996           \n                 95% CI : (0.9899, 0.9989)\n    No Information Rate : 0.4318          \n    P-Value [Acc > NIR] : < 2.2e-16       \n                                          \n                  Kappa : 0.9938          \n                                          \n Mcnemar's Test P-Value : NA              \n\nStatistics by Class:\n\n                     Class: cleared Class: fallen_dry Class: forest\nSensitivity                  0.9949           0.96078        1.0000\nSpecificity                  0.9968           1.00000        0.9965\nPos Pred Value               0.9949           1.00000        0.9954\nNeg Pred Value               0.9968           0.99792        1.0000\nPrevalence                   0.3893           0.05040        0.4318\nDetection Rate               0.3874           0.04842        0.4318\nDetection Prevalence         0.3893           0.04842        0.4338\nBalanced Accuracy            0.9958           0.98039        0.9983\n                     Class: water\nSensitivity                1.0000\nSpecificity                1.0000\nPos Pred Value             1.0000\nNeg Pred Value             1.0000\nPrevalence                 0.1285\nDetection Rate             0.1285\nDetection Prevalence       0.1285\nBalanced Accuracy          1.0000\n```\n\n\n:::\n:::\n\n\n결과를 지도로 나타낸다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nr <- as.factor(sc_svm$map)\nlevels(r) <- data.frame(ID = 1:4, class_supervised = levels(train$class))\n\ntm_shape(r) + tm_raster(\n  palette = c(\"yellow\", \"sandybrown\", \"darkgreen\", \"blue\"),\n  title = \"Classes\") +\n  tm_layout(\n    legend.outside = TRUE, \n    title = \"AI-based Classification: \\n Random Forest\")\n```\n\n::: {.cell-output-display}\n![](4_3_image_classification_files/figure-html/unnamed-chunk-15-1.png){width=7200}\n:::\n:::\n\n\n### 인공신경망(artificial neural network, ANN)\n\n인공신경망 알고리즘을 적용한다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsc_ann <- superClass(\n  lsat, \n  trainData = train, \n  responseCol = \"class\",\n  model = \"nnet\", \n  tuneLength = 3, \n  trainPartition = 0.7,\n  verbose = FALSE,\n  trace = FALSE)\n\nsc_ann$modelFit\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n  TrainAccuracy TrainKappa method\n1     0.9953569  0.9927041   nnet\n\n[[2]]\nCross-Validated (5 fold) Confusion Matrix \n\n(entries are average cell counts across resamples)\n \n            Reference\nPrediction   cleared fallen_dry forest water\n  cleared      128.6        0.2    0.6   0.0\n  fallen_dry     0.0       15.2    0.4   0.0\n  forest         0.6        0.0  236.0   0.0\n  water          0.0        0.2    0.2  92.2\n                            \n Accuracy (average) : 0.9954\n```\n\n\n:::\n\n```{.r .cell-code}\nsc_ann$validation$performance\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nConfusion Matrix and Statistics\n\n            Reference\nPrediction   cleared fallen_dry forest water\n  cleared        222          0      0     0\n  fallen_dry       0         46     18     0\n  forest          66          0    720     0\n  water            0          0      0   139\n\nOverall Statistics\n                                          \n               Accuracy : 0.9306          \n                 95% CI : (0.9148, 0.9443)\n    No Information Rate : 0.6094          \n    P-Value [Acc > NIR] : < 2.2e-16       \n                                          \n                  Kappa : 0.8729          \n                                          \n Mcnemar's Test P-Value : NA              \n\nStatistics by Class:\n\n                     Class: cleared Class: fallen_dry Class: forest\nSensitivity                  0.7708           1.00000        0.9756\nSpecificity                  1.0000           0.98455        0.8605\nPos Pred Value               1.0000           0.71875        0.9160\nNeg Pred Value               0.9333           1.00000        0.9576\nPrevalence                   0.2378           0.03799        0.6094\nDetection Rate               0.1833           0.03799        0.5945\nDetection Prevalence         0.1833           0.05285        0.6491\nBalanced Accuracy            0.8854           0.99227        0.9180\n                     Class: water\nSensitivity                1.0000\nSpecificity                1.0000\nPos Pred Value             1.0000\nNeg Pred Value             1.0000\nPrevalence                 0.1148\nDetection Rate             0.1148\nDetection Prevalence       0.1148\nBalanced Accuracy          1.0000\n```\n\n\n:::\n:::\n\n\n결과를 지도로 나타낸다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nr <- as.factor(sc_ann$map)\nlevels(r) <- data.frame(ID = 1:4, class_supervised = levels(train$class))\n\ntm_shape(r) + tm_raster(\n  palette = c(\"yellow\", \"sandybrown\", \"darkgreen\", \"blue\"),\n  title = \"Classes\") +\n  tm_layout(\n    legend.outside = TRUE, \n    title = \"AI-based Classification: \\n ANN\")\n```\n\n::: {.cell-output-display}\n![](4_3_image_classification_files/figure-html/unnamed-chunk-17-1.png){width=7200}\n:::\n:::\n\n\n### 합성곱신경망(convolution neural network, CNN)\n",
    "supporting": [
      "4_3_image_classification_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}